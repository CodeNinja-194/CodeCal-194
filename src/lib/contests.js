export const fallbackContests = [
    // Week 1-2 (Jan 8-17)
    { id: 1, platform: 'AtCoder', name: 'Beginner Contest 440', time: new Date("2026-01-10T21:00:00"), url: 'https://atcoder.jp/contests/abc440' },
    { id: 2, platform: 'LeetCode', name: 'Weekly Contest 484', time: new Date("2026-01-11T08:00:00"), url: 'https://leetcode.com/contest/weekly-contest-484/' },
    { id: 3, platform: 'AtCoder', name: 'Regular Contest 212', time: new Date("2026-01-11T21:00:00"), url: 'https://atcoder.jp/contests/arc212' },
    { id: 4, platform: 'CodeForces', name: 'Div 3 Round 1072', time: new Date("2026-01-12T17:35:00"), url: 'https://codeforces.com/contests' },
    { id: 5, platform: 'CodeChef', name: 'Starters 221', time: new Date("2026-01-14T20:00:00"), url: 'https://www.codechef.com/contests' },
    { id: 6, platform: 'CodeForces', name: 'Div 2 Round 1073', time: new Date("2026-01-15T20:35:00"), url: 'https://codeforces.com/contests' },
    { id: 7, platform: 'LeetCode', name: 'Biweekly Contest 174', time: new Date("2026-01-17T07:30:00"), url: 'https://leetcode.com/contest/biweekly-contest-174/' },
    { id: 8, platform: 'AtCoder', name: 'Beginner Contest 441', time: new Date("2026-01-17T21:00:00"), url: 'https://atcoder.jp/contests/abc441' },

    // Week 3 (Jan 18-24)
    { id: 9, platform: 'LeetCode', name: 'Weekly Contest 485', time: new Date("2026-01-18T08:00:00"), url: 'https://leetcode.com/contest/weekly-contest-485/' },
    { id: 10, platform: 'CodeForces', name: 'Educational Round 178', time: new Date("2026-01-19T17:35:00"), url: 'https://codeforces.com/contests' },
    { id: 11, platform: 'CodeChef', name: 'Starters 222', time: new Date("2026-01-21T20:00:00"), url: 'https://www.codechef.com/contests' },
    { id: 12, platform: 'CodeForces', name: 'Div 1+2 Round 1074', time: new Date("2026-01-22T20:35:00"), url: 'https://codeforces.com/contests' },
    { id: 13, platform: 'AtCoder', name: 'Beginner Contest 442', time: new Date("2026-01-24T21:00:00"), url: 'https://atcoder.jp/contests/abc442' },

    // Week 4 (Jan 25-31)
    { id: 14, platform: 'LeetCode', name: 'Weekly Contest 486', time: new Date("2026-01-25T08:00:00"), url: 'https://leetcode.com/contest/weekly-contest-486/' },
    { id: 15, platform: 'CodeForces', name: 'Div 2 Round 1075', time: new Date("2026-01-26T17:35:00"), url: 'https://codeforces.com/contests' },
    { id: 16, platform: 'CodeChef', name: 'Starters 223', time: new Date("2026-01-28T20:00:00"), url: 'https://www.codechef.com/contests' },
    { id: 17, platform: 'LeetCode', name: 'Biweekly Contest 175', time: new Date("2026-01-31T20:00:00"), url: 'https://leetcode.com/contest/biweekly-contest-175/' },
    { id: 18, platform: 'AtCoder', name: 'Beginner Contest 443', time: new Date("2026-01-31T21:00:00"), url: 'https://atcoder.jp/contests/abc443' },
    { id: 19, platform: 'CodeForces', name: 'Round 1077 (Div. 1)', time: new Date("2026-01-29T20:05:00"), url: 'https://codeforces.com/contests' },
    { id: 20, platform: 'CodeForces', name: 'Round 1077 (Div. 2)', time: new Date("2026-01-29T20:05:00"), url: 'https://codeforces.com/contests' },

    // February Week 1 (Feb 1-7)
    { id: 21, platform: 'LeetCode', name: 'Weekly Contest 487', time: new Date("2026-02-01T08:00:00"), url: 'https://leetcode.com/contest/weekly-contest-487/' },
    { id: 22, platform: 'CodeForces', name: 'Div 3 Round 1076', time: new Date("2026-02-02T17:35:00"), url: 'https://codeforces.com/contests' },
    { id: 23, platform: 'CodeChef', name: 'Starters 224', time: new Date("2026-02-04T20:00:00"), url: 'https://www.codechef.com/contests' },
    { id: 24, platform: 'AtCoder', name: 'Regular Contest 213', time: new Date("2026-02-07T21:00:00"), url: 'https://atcoder.jp/contests/arc213' },
    { id: 25, platform: 'AtCoder', name: 'Beginner Contest 444', time: new Date("2026-02-07T21:00:00"), url: 'https://atcoder.jp/contests/abc444' },

    // February Week 2 (Feb 8-14)
    { id: 26, platform: 'LeetCode', name: 'Biweekly Contest 176', time: new Date("2026-02-08T07:30:00"), url: 'https://leetcode.com/contest/biweekly-contest-176/' },
    { id: 27, platform: 'CodeForces', name: 'Div 2 Round 1077', time: new Date("2026-02-09T17:35:00"), url: 'https://codeforces.com/contests' },
    { id: 28, platform: 'LeetCode', name: 'Weekly Contest 488', time: new Date("2026-02-08T08:00:00"), url: 'https://leetcode.com/contest/weekly-contest-488/' },
    { id: 28, platform: 'CodeChef', name: 'Starters 225', time: new Date("2026-02-11T20:00:00"), url: 'https://www.codechef.com/contests' },
    { id: 29, platform: 'CodeForces', name: 'Educational Round 179', time: new Date("2026-02-12T17:35:00"), url: 'https://codeforces.com/contests' },
    { id: 30, platform: 'AtCoder', name: 'Beginner Contest 445', time: new Date("2026-02-14T21:00:00"), url: 'https://atcoder.jp/contests/abc445' },

    // February Week 3 (Feb 15-21)
    { id: 31, platform: 'LeetCode', name: 'Weekly Contest 489', time: new Date("2026-02-15T08:00:00"), url: 'https://leetcode.com/contest/weekly-contest-489/' },
    { id: 32, platform: 'CodeForces', name: 'Div 1+2 Round 1078', time: new Date("2026-02-16T20:35:00"), url: 'https://codeforces.com/contests' },
    { id: 33, platform: 'CodeChef', name: 'Starters 226', time: new Date("2026-02-18T20:00:00"), url: 'https://www.codechef.com/contests' },
    { id: 34, platform: 'CodeForces', name: 'Div 3 Round 1079', time: new Date("2026-02-19T17:35:00"), url: 'https://codeforces.com/contests' },
    { id: 35, platform: 'AtCoder', name: 'Beginner Contest 446', time: new Date("2026-02-21T21:00:00"), url: 'https://atcoder.jp/contests/abc446' },

    // February Week 4 (Feb 22-28)
    { id: 36, platform: 'LeetCode', name: 'Weekly Contest 490', time: new Date("2026-02-22T08:00:00"), url: 'https://leetcode.com/contest/weekly-contest-490/' },
    { id: 37, platform: 'CodeForces', name: 'Div 2 Round 1080', time: new Date("2026-02-23T17:35:00"), url: 'https://codeforces.com/contests' },
    { id: 38, platform: 'CodeChef', name: 'Starters 227', time: new Date("2026-02-25T20:00:00"), url: 'https://www.codechef.com/contests' },
    { id: 39, platform: 'LeetCode', name: 'Biweekly Contest 177', time: new Date("2026-02-28T07:30:00"), url: 'https://leetcode.com/contest/biweekly-contest-177/' },
    { id: 40, platform: 'AtCoder', name: 'Regular Contest 214', time: new Date("2026-02-28T21:00:00"), url: 'https://atcoder.jp/contests/arc214' },
    { id: 41, platform: 'AtCoder', name: 'Beginner Contest 447', time: new Date("2026-02-28T21:00:00"), url: 'https://atcoder.jp/contests/abc447' }
];

export async function fetchContests() {
    // Primary source: internal API backed by Supabase
    try {
        const response = await fetch('/api/contests');
        if (response.ok) {
            const data = await response.json();
            if (data && data.contests) {
                console.log("Fetched contests from internal API.");
                const dbContests = data.contests.map(c => ({
                    ...c,
                    time: new Date(c.startTime),
                    id: c.id || Math.random()
                }));

                // merge with fallback history to avoid gaps
                const merged = [...dbContests, ...fallbackContests.map(c => ({ ...c, time: new Date(c.time) }))];
                const unique = Array.from(
                    new Map(
                        merged.map(c => [
                            c.name + (c.time instanceof Date ? c.time.getTime() : new Date(c.time).getTime()),
                            c
                        ])
                    ).values()
                );

                return sortContests(unique);
            }
        }
    } catch (e) {
        console.warn("Internal API fetch failed, falling back to local data.", e);
    }

    // Fallback: use hardcoded list
    console.log("Using hardcoded fallback data.");
    return sortContests(fallbackContests.map(c => ({ ...c, time: new Date(c.time) })));
}

function sortContests(contests) {
    return contests.sort((a, b) => {
        const aTime = a.time instanceof Date ? a.time : new Date(a.time);
        const bTime = b.time instanceof Date ? b.time : new Date(b.time);
        return aTime - bTime;
    });
}

// Parse duration string to milliseconds (e.g., "02:00:00" -> 7200000)
function parseDuration(durationStr) {
    if (!durationStr) return 2 * 60 * 60 * 1000;
    if (typeof durationStr === 'number') return durationStr * 1000;
    const parts = durationStr.split(':').map(Number);
    if (parts.length === 3) {
        return (parts[0] * 3600 + parts[1] * 60 + parts[2]) * 1000;
    }
    return 2 * 60 * 60 * 1000;
}
